# Impact Management System - 用户操作手册

## 目录
1. [系统概述](#系统概述)
2. [启动应用](#启动应用)
3. [页面功能详解](#页面功能详解)
4. [使用场景示例](#使用场景示例)
5. [常见问题](#常见问题)

---

## 系统概述

Impact Management System 是一个用于管理和执行数据库影响分析的工具。系统包含4个主要功能模块：

- **Impact Execute**: 执行 SQL 查询并分析结果（核心功能）
- **DB Connect Manage**: 管理数据库连接配置
- **Impact Manage**: 管理影响场景和 SQL 配置
- **Action Manage**: 管理针对影响的操作建议

---

## 启动应用

### 方式1: 使用命令行
```bash
cd ImpactManagement
dotnet run
```

### 方式2: 使用 Visual Studio
1. 打开 `ImpactManagement.csproj`
2. 按 F5 启动调试

### 初次启动
应用启动后会显示主界面，默认显示 "Impact Execute" 页面。顶部蓝色导航栏包含4个按钮，可以切换不同的管理页面。

---

## 页面功能详解

### 1. DB Connect Manage (数据库连接管理)

#### 页面布局
- **左侧**: 数据库连接列表（表格形式）
- **右侧**: 连接详情表单

#### 字段说明
| 字段名 | 说明 | 是否必填 | 备注 |
|--------|------|----------|------|
| Connect Name | 连接名称 | 是 | 必须唯一 |
| IP | 数据库IP地址 | 是 | 如: 192.168.1.100 |
| Port | 端口号 | 是 | Oracle默认: 1521 |
| Schema | 数据库Schema | 是 | 如: PROD_SCHEMA |

#### 操作步骤

**添加连接:**
1. 在右侧表单中填写所有字段
2. 点击 "Add" 按钮
3. 左侧列表会显示新添加的连接

**修改连接:**
1. 在左侧列表中点击选择要修改的连接
2. 右侧表单会自动填充该连接的信息
3. 修改需要更改的字段
4. 点击 "Update" 按钮

**删除连接:**
1. 在左侧列表中点击选择要删除的连接
2. 点击 "Delete" 按钮
3. 确认删除操作

**清空表单:**
- 点击 "Clear" 按钮清空右侧表单所有输入

#### 注意事项
- ⚠️ ConnectName 必须唯一，否则无法添加
- ⚠️ 删除连接前请确保没有影响配置在使用该连接

---

### 2. Impact Manage (影响管理)

#### 页面布局
- **左侧**: 影响列表（表格形式）
- **右侧**: 影响详情表单（支持滚动）

#### 字段说明
| 字段名 | 说明 | 是否必填 | 备注 |
|--------|------|----------|------|
| Scene Name | 场景名称 | 是 | 如: Performance Issue |
| Impact Name | 影响名称 | 是 | 必须唯一 |
| Connect Name | 数据库连接 | 是 | 下拉框选择 |
| SQL | SQL语句 | 是 | **重点内容**，大文本框 |
| Group Field | 分组字段 | 否 | 用于结果分组，如: department |

#### SQL 替换项功能

替换项用于在 SQL 中定义动态参数，格式为 `{PARAMETER_NAME}`。

**示例 SQL:**
```sql
SELECT * FROM USERS 
WHERE status = '{STATUS}' 
  AND created_date > '{DATE}'
  AND department = '{DEPT}'
```

**添加替换项:**
1. 在 "Replace Items" 区域的输入框中输入替换项（如: `{STATUS}`）
2. 点击 "Add Item" 按钮
3. 重复以上步骤添加更多替换项
4. 替换项列表会显示所有已添加的项

**删除替换项:**
- 点击列表中替换项旁边的 "Remove" 按钮

#### 操作步骤

**添加影响:**
1. 填写 Scene Name, Impact Name
2. 从下拉框选择 Connect Name
3. 在 SQL 大文本框中输入 SQL 语句（支持多行）
4. 可选：填写 Group Field
5. 可选：添加 SQL 替换项
6. 点击 "Add" 按钮

**修改影响:**
1. 在左侧列表中选择要修改的影响
2. 修改右侧表单中的信息
3. 点击 "Update" 按钮

**删除影响:**
1. 选择要删除的影响
2. 点击 "Delete" 按钮
3. 确认删除

#### 注意事项
- ⚠️ SQL 字段是核心内容，请仔细编写
- ⚠️ 替换项必须与 SQL 中的占位符完全匹配（包括大括号）
- ⚠️ Group Field 应该是 SQL 查询结果中的列名

---

### 3. Action Manage (操作管理)

#### 页面布局
- **左侧**: 操作列表（表格形式）
- **右侧**: 操作详情表单

#### 字段说明
| 字段名 | 说明 | 是否必填 | 备注 |
|--------|------|----------|------|
| Impact Name | 影响名称 | 是 | 下拉框选择 |
| Group Field Value | 分组值 | 否 | 如: IT, Sales |
| Action Description | 操作描述 | 否 | 多行文本 |
| Op Owner | 操作负责人 | 否 | 如: John Doe |
| Action Owner | 行动负责人 | 否 | 如: Jane Smith |
| Action Tool | 操作工具 | 否 | 如: SQL Optimizer |

#### 操作步骤

**添加操作:**
1. 从下拉框选择 Impact Name
2. 填写 Group Field Value（与 Impact 的 Group Field 对应）
3. 填写操作描述和负责人信息
4. 点击 "Add" 按钮

**修改和删除操作:**
- 与其他管理页面类似

#### 注意事项
- ⚠️ Group Field Value 应与 Impact Execute 页面的分组过滤对应
- 💡 一个 Impact 可以有多个不同 Group Value 的操作

---

### 4. Impact Execute (影响执行) ⭐ 核心功能

#### 页面布局（从上到下）
1. **场景和影响选择区**: 选择要执行的影响
2. **SQL 和连接信息区**: 显示 SQL 和数据库连接（重点展示）
3. **替换项输入区**: 输入 SQL 参数值（如果有）
4. **查询执行和过滤区**: 执行按钮和分组过滤
5. **结果展示区**: 查询结果表格（重点展示）
6. **相关操作区**: 显示该分组的操作建议

#### 使用流程

**第1步: 选择场景和影响**
1. 从 "Scene Name" 下拉框选择场景
2. 从 "Impact Name" 下拉框选择影响（自动过滤）
3. 页面会自动显示该影响的详细信息

**第2步: 查看 SQL 和连接信息**
- 连接信息格式: `ConnectName - IP:Port/Schema`
- SQL 显示在灰色背景的只读文本框中（重点展示）

**第3步: 填写替换项（如果有）**
- 如果 SQL 有替换项，会显示输入框
- 每个替换项都有对应的输入框
- 示例:
  - `{STATUS}` → 输入 "active"
  - `{DATE}` → 输入 "2024-01-01"

**第4步: 执行查询**
1. 点击绿色的 "Execute Query" 按钮
2. 系统会用输入的值替换 SQL 中的占位符
3. 执行查询并显示结果

**第5步: 查看结果**
- 结果显示在大表格中（蓝色表头）
- 支持:
  - 列排序（点击列头）
  - 多选行
  - 水平和垂直滚动
  - 斑马纹显示（提高可读性）

**第6步: 分组过滤（可选）**
- 如果 Impact 配置了 Group Field，会显示过滤下拉框
- 选择分组值后，表格只显示该分组的数据
- 同时会显示该分组相关的操作建议

**第7步: 导出结果**
- 点击 "Export to CSV" 按钮
- 选择保存位置和文件名
- 结果会保存为 CSV 文件（UTF-8 编码）

#### 页面元素说明

**Execute Query 按钮** (绿色背景)
- 执行 SQL 查询
- 需要先选择 Impact Name 和填写所有替换项

**Export to CSV 按钮**
- 导出查询结果
- 只有在有查询结果时才可用

**Group Filter 下拉框**
- 按分组字段值过滤结果
- 只有在 Group Field 配置且有查询结果时显示

**结果表格特点:**
- 📊 自动生成列（根据查询结果）
- 🎨 蓝色表头，白色/浅灰交替行
- 📏 网格线清晰
- 🔍 支持排序和多选

**操作建议区域:**
- 显示与当前分组值相关的操作
- 包含操作描述、负责人、工具等信息

---

## 使用场景示例

### 场景1: 性能问题分析

**背景**: 需要查询特定状态和日期范围内的用户，并按部门分析

**步骤:**

1. **配置数据库连接** (DB Connect Manage)
   ```
   Connect Name: ProductionDB
   IP: 192.168.1.100
   Port: 1521
   Schema: PROD_SCHEMA
   ```

2. **配置影响** (Impact Manage)
   ```
   Scene Name: Performance Issue
   Impact Name: Slow Query Impact
   Connect Name: ProductionDB
   SQL: SELECT * FROM USERS 
        WHERE status = '{STATUS}' 
        AND created_date > '{DATE}'
   Group Field: department
   Replace Items: {STATUS}, {DATE}
   ```

3. **配置操作** (Action Manage)
   
   操作1:
   ```
   Impact Name: Slow Query Impact
   Group Field Value: IT
   Action Description: 优化查询并添加索引
   Op Owner: John Doe
   Action Owner: Jane Smith
   Action Tool: SQL Optimizer
   ```
   
   操作2:
   ```
   Impact Name: Slow Query Impact
   Group Field Value: Sales
   Action Description: 审查数据访问模式
   Op Owner: Bob Johnson
   Action Owner: Alice Williams
   Action Tool: Performance Monitor
   ```

4. **执行查询** (Impact Execute)
   - 选择 Scene: Performance Issue
   - 选择 Impact: Slow Query Impact
   - 填写 {STATUS}: active
   - 填写 {DATE}: 2024-01-01
   - 点击 Execute Query
   - 查看结果
   - 选择 Group Value: IT
   - 查看 IT 部门的数据和相关操作

---

### 场景2: 数据质量检查

**背景**: 查找订单状态为空的数据

**步骤:**

1. **配置影响** (Impact Manage)
   ```
   Scene Name: Data Quality
   Impact Name: Missing Data Impact
   Connect Name: ProductionDB
   SQL: SELECT * FROM ORDERS 
        WHERE order_status IS NULL
   Group Field: (留空)
   Replace Items: (无)
   ```

2. **执行查询** (Impact Execute)
   - 选择 Scene: Data Quality
   - 选择 Impact: Missing Data Impact
   - 直接点击 Execute Query（无需填写替换项）
   - 查看所有订单状态为空的记录
   - 导出结果进行后续处理

---

## 常见问题

### Q1: 为什么添加数据库连接时提示 "ConnectName must be unique"？
**A**: ConnectName 必须是唯一的。请检查是否已存在同名连接，或使用不同的名称。

### Q2: SQL 执行后没有显示结果怎么办？
**A**: 
- 确保已正确填写所有替换项
- 检查 SQL 语法是否正确
- 当前使用模拟数据库，返回的是示例数据

### Q3: 如何在 SQL 中使用替换项？
**A**: 
- 格式: `{PARAMETER_NAME}`
- 必须完全匹配（包括大括号和大小写）
- 示例: `WHERE status = '{STATUS}'`

### Q4: Group Field 是什么？如何使用？
**A**: 
- Group Field 是查询结果中的列名
- 用于在 Impact Execute 页面进行分组过滤
- 例如: 如果查询结果有 `department` 列，可以设置 Group Field 为 "department"
- 执行查询后，可以按部门值过滤结果

### Q5: 如何连接真实的 Oracle 数据库？
**A**: 
- 当前版本使用数据库模拟器
- 要连接真实数据库，需要修改 `DatabaseSimulator.cs`
- 使用 Oracle.ManagedDataAccess 包
- 详见 README.md 的扩展说明

### Q6: 导出的 CSV 文件乱码怎么办？
**A**: 
- 文件使用 UTF-8 编码
- 用 Excel 打开时选择 UTF-8 编码
- 或用记事本打开确认内容正确

### Q7: 可以同时执行多个查询吗？
**A**: 
- 当前版本一次只能执行一个查询
- 可以切换不同的 Impact 执行不同查询
- 每次查询结果会覆盖之前的结果

### Q8: 替换项可以有默认值吗？
**A**: 
- 当前版本不支持默认值
- 每次执行都需要手动填写
- 建议记录常用的参数值以便重复使用

---

## 快捷操作提示

### 键盘操作
- Tab: 在表单字段间切换
- Enter: 提交表单（在输入框中）
- Esc: 取消操作

### 表格操作
- 点击列头: 排序
- 点击行: 选择
- Ctrl+点击: 多选
- 拖动列边界: 调整列宽

### 最佳实践
1. ✅ 先配置数据库连接
2. ✅ 再配置影响和 SQL
3. ✅ 测试 SQL 是否正确
4. ✅ 最后配置相关操作
5. ✅ 定期导出重要查询结果

---

## 技术支持

如有问题，请参考:
- README.md - 技术文档
- 项目源码 - 详细实现

---

**版本**: 1.0
**更新日期**: 2025-10-15
